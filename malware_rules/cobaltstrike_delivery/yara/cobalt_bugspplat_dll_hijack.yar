rule cobalt_bugspplat_dll_hijack
{
    meta:
        description = "Malicious BugSplatRc64.dll with MessageBoxW hook and XOR obfuscation"
        author = "Cyber Graf"
        reference = "Cobalt Strike Beacon через GitHub и соцсети, Лаборатория Касперского"
        version = "1.0"
        license = "CC BY 4.0"
        threat_name = "CobaltStrike"

    strings:
        $dllname = "BugSplatRc64.dll"
        $api_hook = "MessageBoxW"
        $new_api = "NewMessageBox"
        $url1 = "techcommunity.microsoft.com/t5/user/viewprofilepage/user-id/2631"
        $url2 = "quora.com/profile/Marieformach"
        $xor = { 33 ?? 8B ?? 33 ?? 8B ?? 33 }

    condition:
        uint16(0) == 0x5A4D and all of ($dllname, $api_hook, $new_api) and 1 of ($url1, $url2) and $xor
}