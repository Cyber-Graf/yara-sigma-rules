rule SLOW_TEMPEST_DLL_OverlayPayload
{
    meta:
        author = "Cyber Graf"
        description = "Detects DLLs with suspicious overlay data used for encrypted payload (SLOW#TEMPEST)"
        license = "CC BY 4.0"
        status = "experimental"

    condition:
        uint16(0) == 0x5A4D and
        filesize > pe.sections[pe.number_of_sections - 1].raw_data_offset +
                   pe.sections[pe.number_of_sections - 1].raw_data_size + 0x400
}