rule ToolShell_RAT_Detector
{
    meta:
        description = "Detects ToolShell RAT binaries with command handlers and RDP proxy functions"
        author = "Cyber Graf"
        reference = "Securelist 2025 â€” SharePoint Exploitation"
        version = "1.0"
        license = "CC BY 4.0"
        threat_name = "ToolShell"

    strings:
        $cmd1 = "GetHost" ascii
        $cmd2 = "LoadDll" ascii
        $cmd3 = "StartRdpProxy" ascii
        $url = "http://" ascii
        $svc = "Software\\ToolShell" ascii

    condition:
        uint16(0) == 0x5A4D and 3 of ($cmd1, $cmd2, $cmd3, $url, $svc)
}