rule FreeIPA_Exploit_Modules
{
    meta:
        description = "Detects API/LDAP abuse for sudo/HBAC/role escalation"
        author = "Cyber Graf"
        version = "1.0"
        license = "CC BY 4.0"
        threat_name = "FreeIPA Privilege Abuse Tools"

    strings:
        $api1 = "krbtpolicy_mod" ascii
        $api2 = "hbacrule_enable" ascii
        $api3 = "sudorule_mod" ascii
        $api4 = "hostgroup_add_member" ascii
        $api5 = "role_add_member" ascii
        $ldap = "ldapmodify -D" ascii
        $kerb1 = "maxrenewlife=" ascii
        $kerb2 = "maxlife=" ascii

    condition:
        2 of ($api*) or ($ldap and any of ($kerb*))
}
