rule FreeIPA_Kerberos_Exploit_Script
{
    meta:
        description = "Detects FreeIPA exploit scripts using Base64 and Kerberos abuse"
        author = "Cyber Graf"
        version = "1.0"
        license = "CC BY 4.0"
        threat_name = "FreeIPA Scripted Exploitation Toolkit"

    strings:
        $kinit = "kinit" ascii nocase
        $kvno = "kvno" ascii nocase
        $krbtgt = "krbtgt@" ascii

        $ps_b64 = "frombase64string" ascii nocase
        $py_b64 = "base64.b64decode" ascii
        $bash_b64 = "echo $b64 | base64 -d" ascii

        $ldap = "ldapmodify -D" ascii nocase
        $sssd = "/var/lib/sss" ascii

        $admin = "admin" ascii
        $root = "root" ascii

    condition:
        (2 of ($kinit, $kvno, $krbtgt)) and 1 of ($ps_b64, $py_b64, $bash_b64) and 1 of ($admin, $root)
}
